
<!doctype html>
<html>
<head>
    <meta charset="utf-8">

    <title>Antoine Jardin's Blog</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>



<body>

    <div class="nav">
        <ul>
        <li><a href="http://antoinejardin.github.io/site/">Home</a>
        <li><a href="#">Data</a>
	<li><a href="http://spire.sciencespo.fr/hdl:/2441/6mnmm960se8udqhl52ulaad5gu">Research</a>
	<li><a href="http://antoinejardin.github.io/site/teaching.html">Teaching</a>
        <li><a href="#">Papers</a>
        <li><a href="#">Archives</a>
        <li><a href="#">Varia</a>
        <li><a href="http://antoinejardin.github.io/site/about.html">About Me</a>
    </ul>
	</div>

    <div class="content">


<p>Choosing a modelling technique</p>

<pre>
	
Stata Manual makes the following point : 

************************************
Remarks on using sampling weights

    Sampling weights are treated differently in multilevel models than they are
    in standard models such as OLS regression.  In a multilevel model,
    observation-level weights are not indicative of overall inclusion.
    Instead, they indicate inclusion conditional on the corresponding cluster
    being included at the next highest-level of sampling.

    For example, if you include only observation-level weights in a two-level
    model, mixed will assume sampling with equal probabilities at level two,
    and this may or may not be what you intended.  If the sampling at level two
    is weighted, then including only level-one weights can lead to biased
    results even if weighting at level two has been incorporated into the
    level-one weight variable.  For example, it is a common practice to
    multiply conditional weights from multiple levels into one overall weight.
    By contrast, weighted multilevel analysis requires the component weights
    from each level of sampling.

    Even if you specify sampling weights at all model levels, the scale of
    sampling weights at lower levels can affect your estimated parameters in a
    multilevel model.  That is, not only do the relative sizes of the weights
    at lower levels matter, the scale of these weights matters also.  To deal
    with this, mixed has the pwscale() option for rescaling weights in
    two-level models; see above for more information on pwscale().  Three
    scaling methods are offered, with each method known to perform well under
    certain data situations and posited models.

    In general, exercise caution when using sampling weights with mixed; see 
    Survey data in [ME] mixed for more information.
************************************

Hence it seems better to only pick OLS models with several interactions
</pre>

<p>Romaphobia modeling<p>

<pre>
library(ordinal)
library(dplyr)
library(foreign)
library(lme4)
</pre>
<p></p>
<pre>
roma <- read.csv("~/roma.csv")
</pre>
<p></p>

<pre>
rom <- select(roma, -(X.2:X))
</pre>
<p></p>

<pre>
rom$contact <- as.factor(rom$contact)
</pre>
<p></p>

<pre>
fm1 <- clm(contact ~ gender + educ + age + ethno + place + relig + country, data=rom, Hess = TRUE, link="logit")

fm1p <- clm(contact ~ gender + educ + age + ethno + place + relig + country, data=rom, Hess = TRUE, link="logit", weights=pond)
</pre>
<p></p>

<pre>
rom$roma <- as.factor(rom$roma)
</pre>
<p></p>

<pre>
fm2 <- clm(roma ~ gender + educ + age + ethno + place + relig + contact + country, data=rom, Hess = TRUE, link="probit")

fm2p <- clm(roma ~ gender + educ + age + ethno + place + relig + contact + country, data=rom, Hess = TRUE, link="probit", weights=pond)
</pre>
<p></p>

<pre>
summary(fm1)
summary(fm1p)

summary(fm2)
summary(fm2p)
</pre>
<p></p>

<pre>
fm1r <- clmm(contact ~ gender + educ + age + ethno + place + relig + (1 | country), data=rom, Hess = TRUE, link="logit")
fm1rp <- clmm(contact ~ gender + educ + age + ethno + place + relig + (1 | country), data=rom, Hess = TRUE, link="logit", weights=pond)
</pre>
<p></p>

<pre>
fm2rp <- clmm(roma ~ gender + educ + age + ethno + place + relig + contact + ( 1 | country) , data=rom, Hess = TRUE, link="probit", weights=pond)
</pre>
<p></p>

<pre>
fm3p <- clm(roma ~ contact*country , data=rom, Hess = TRUE, link="probit", weights=pond)
</pre>
<p></p>

<pre>
summary(fm3p)

fit.fm3p <- fitted(fm3p)

summary(fm1p)
summary(fm1rp)
summary(fm2p)
summary(fm1p)
summary(fm2)
</pre>
<p></p>

<pre>
fm4p <- clmm(roma ~ gender + (1 + contact | country) , data=rom, Hess = TRUE, link="probit", weights=pond)

summary(fm4p)
ranef(fm4p)
</pre>
<p></p>

<pre>
doc <- as.data.frame(ranef(fm4p))

View(doc)
</pre>
<p></p>

<pre>
fm5p <- clmm(roma ~ gender + ethno + contact + (1 + contact | country) , data=rom, Hess = TRUE, link="probit", weights=pond)

fm6p <- clmm(roma ~ gender + ethno + contact + (1 + contact + ethno | country) , data=rom, Hess = TRUE, link="probit", weights=pond)

fm7p <- clmm(roma ~ gender + ethno + (1 + contact | country) , data=rom, Hess = TRUE, link="probit", weights=pond)
</pre>
<p></p>

<pre>
summary(fm7p)
ranef(fm7p)

summary(fm6p)
ranef(fm6p)
</pre>
<p></p>

<pre>
fm8p <- clmm(roma ~ gender + ethno + educ + (1 + contact | country) , data=rom, Hess = TRUE, link="probit", weights=pond)
</pre>
<p></p>

<pre>
summary(fm8p)
ranef(fm8p)
ran8 <- as.data.frame(ranef(fm8p))

rom$f.ethno <- as.factor(rom$ethno)
</pre>
<p></p>

<pre>
summary(fm8p)
pred8 <- fitted(fm8p)
res8 <- cbind(pred8, rom)
head(res8)
</pre>
<p></p>

<pre>
write.csv(res8, file="~/res8.csv")
write.dta(res8, file="~/res8.dta")
</pre>
<p></p>

<pre>
fm9p <- lmer(roma ~ gender + ethno + educ + (1 + contact | country) , data=rom, weights=pond)
</pre>
<p></p>

<pre>
summary(fm9p)
ranef(fm9p)
pred9 <- fitted(fm9p)
base9 <- fm9p@frame
res9 <- cbind(base9, pred9)
</pre>
<p></p>

<pre>
write.dta(res9, file="~/res.dta")
write.dta(res9, file="~/res9.dta")
</pre>
<p></p>

<pre>
savehistory("~/tommaso_clm.Rhistory")
</pre>
<p></p>

</div>

<div class="footer">
Made in HTML and CSS - Antoine Jardin - 2015
<div>


</body>
</html>

